INSERT INTO blocks VALUES ('anonymous_rsvp_form','<FIELDSET>\r\n<LEGEND>RSVP</LEGEND>\r\nPlease <a href=\"/login\">sign in</a> or <a href=\"/newuser\">create an account</a> to RSVP.\r\n</FIELDSET>\r\n','1','','Calendars and Events','default','en');
INSERT INTO blocks VALUES ('calendar_monthly_one_week','<TR>\r\n %%wk%%week%%_d1%%\r\n %%wk%%week%%_d2%%\r\n %%wk%%week%%_d3%%\r\n %%wk%%week%%_d4%%\r\n %%wk%%week%%_d5%%\r\n %%wk%%week%%_d6%%\r\n %%wk%%week%%_d7%%\r\n <td style=\"width: 20px;\"><a href=\"%%rootdir%%/calendar/weekly/%%cal_id%%/%%wk%%week%%%%\">W<br>E<br>E<br>K</a></td>\r\n</TR>','1','','Calendars and Events','default','en');
INSERT INTO blocks VALUES ('calendar_css','/* calendar stuff */\r\n\r\n.cal_head { }\r\n\r\n.cal_head ul  {\r\n               border: 0;\r\n               margin-top: 10px;\r\n               margin-left: 0;\r\n               padding-left: 0;\r\n               list-style-type: none;\r\n               text-align: center;\r\n               }\r\n\r\n.cal_head ul li  {\r\n               display: inline;\r\n               text-align: center;\r\n               float: left;\r\n               padding: 0;\r\n               margin: 0;\r\n               }\r\n\r\n.cal_head ul li a  {\r\n               border: 1px solid #006;\r\n               margin: 0;\r\n               padding: 5px;\r\n               color: #3B3B3B;\r\n               text-decoration: none;\r\n               display: block;\r\n               text-align: center;\r\n               font: normal 10px/18px \"Lucida Grande\", \"Lucida Sans Unicode\", verdana, lucida, sans-serif;\r\n               }\r\n\r\n.cal_head ul li a:hover  {\r\n                color: #fff;\r\n                background: #3B3B3B;\r\n                }\r\n\r\n.cal_head UL LI A#current { background-color: #ff0000;\r\n                            color: #ffffff;\r\n                            font-weight: bold; }\r\n\r\n.cal_body {  }\r\n\r\n.cal_body TD { border-top: 1px solid black;\r\n               border-left: 1px solid black;\r\n               border-right: 0px;\r\n               border-bottom: 0px;\r\n               padding: 3px; \r\n               height: 25px;\r\n             }\r\n\r\n.cal_body TD { width: 100px;\r\n               height: 100px;\r\n             }\r\n\r\n.cal_body TH { border-right: 0px;\r\n               border-bottom: 0px;\r\n             }\r\n\r\n.cal_mini_body TD,TH { border: 1px solid black;\r\n                  padding: 1px; \r\n                  height: 5px;\r\n                }\r\n.cal_mini_body TD { width: 10px;\r\n               height: 10px;\r\n             }\r\n\r\n.cal_day_head { height: 25px; }\r\n\r\n.cal_body #today { background-color: #eeeeee; }\r\n.cal_body #other_month { background-color: #cccccc; }\r\n\r\n.date_number a { font-size: 12px; \r\n               border-right: 1px solid black;\r\n               border-bottom: 1px solid black;\r\n               padding: 3px;\r\n               min-wdth: 14px;\r\n               margin-left: -3px;\r\n               margin-top -3px;\r\n}\r\n\r\n.tinylink   { font-size: 9px;\r\n              font-weight: normal;\r\n              font-stretch: wider;\r\n            }\r\n\r\n.event_body { border: 1px solid #222; \r\n              background-color: #F5F5CE;\r\n              margin-left: 25px;\r\n              margin-right:25px;\r\n            }\r\n\r\n.event_title { background-color: #9E7B1B;\r\n               color: #fff;\r\n               font-size: 15px;\r\n               font-weight: bold;\r\n               padding-top:5px;\r\n               padding-bottom:6px;\r\n             }\r\n\r\n.event_details { padding-left: 10px;\r\n                 padding-right:10px;\r\n               }\r\n\r\n.child_event_list { padding-left: 10px;\r\n                    padding-right:10px;\r\n                    margin-left: 25px;\r\n                    margin-right:25px;\r\n\r\n               }','1','','CSS','default','en');
INSERT INTO blocks VALUES ('css_includes','<LINK rel=\"stylesheet\" type=\"text/css\" href=\"%%rootdir%%/css/main\">\r\n<LINK rel=\"stylesheet\" type=\"text/css\" href=\"%%rootdir%%/css/calendar\">','1','','CSS','default','en');

UPDATE blocks SET block = '<table border=0 cellpadding=0 cellspacing=0 width=\"100%\"><tr><td>\r\n<DIV class=\"cal_head\">\r\n<div class=\"title\">%%calendar_title%% - %%dow%% <a href=\"%%rootdir%%/calendar/monthly/%%cal_id%%/%%year%%-%%monthnum%%\">%%month%%</a> %%day_num%%, %%year%%</div>\r\n%%BOX,calendar_actions%%\r\n<table align=\"center\" border=0 cellpadding=0 cellspacing=0><tr><td>\r\n<UL>\r\n%%BOX,calendar_datenav%%\r\n</UL>\r\n</td></tr></table>\r\n</DIV>\r\n</td></tr></table>\r\n<p>\r\n<DIV class=\"cal_body\">\r\n\r\n<table width=\"100%\" border=0 cellpadding=0 cellspacing=0 style=\"border-right: 1px solid black; border-bottom: 1px solid black;\">\r\n<tr>%%day%%</tr>\r\n</table>\r\n</div>' WHERE bid = 'calendar_body_daily';
UPDATE blocks SET block = '<table border=0 cellpadding=0 cellspacing=0 width=\"100%\"><tr><td>\r\n<DIV class=\"cal_head\">\r\n<div class=\"title\">%%calendar_title%% - %%longdate%%</div>\r\n%%BOX,calendar_actions%%\r\n<table align=\"center\" border=0 cellpadding=0 cellspacing=0><tr><td>\r\n<UL>\r\n%%BOX,calendar_datenav%%\r\n</UL>\r\n</td></tr></table>\r\n</DIV>\r\n</td></tr></table>\r\n<p>\r\n<DIV class=\"cal_body\">\r\n\r\n<TABLE width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"border-right: 1px solid black; border-bottom: 1px solid black;\">\r\n<TR>\r\n <TH>Monday</TH>\r\n <TH>Tuesday</TH>\r\n <TH>Wednesday</TH>\r\n <TH>Thursday</TH>\r\n <TH>Friday</TH>\r\n <TH>Saturday</TH>\r\n <TH>Sunday</TH>\r\n <TH> </TH>\r\n</TR>\r\n%%rows%%\r\n</TABLE>\r\n</DIV>\r\n%%subscribe_link%%' WHERE bid = 'calendar_body_monthly';
UPDATE blocks SET block = '<TD%%hilight%% valign=\"top\"><DIV class=\"cal_day\">\r\n<DIV class=\"date_number\"><A href=\"%%rootdir%%/calendar/daily/%%cal_id%%/%%year%%-%%month%%-%%date_number%%\">%%date_number%%</A></DIV>\r\n%%events%%\r\n</DIV></TD>' WHERE bid = 'calendar_body_one_day';
UPDATE blocks SET block = '<table border=0 cellpadding=0 cellspacing=0 width=\"100%\"><tr><td>\r\n<DIV class=\"cal_head\">\r\n<div class=\"title\">%%calendar_title%% - Week starting %%dow%% <a href=\"%%rootdir%%/calendar/monthly/%%cal_id%%/%%year%%-%%monthnum%%\">%%month%%</a> %%day_num%%, %%year%%</div>\r\n%%BOX,calendar_actions%%\r\n<table align=\"center\" border=0 cellpadding=0 cellspacing=0><tr><td>\r\n<UL>\r\n%%BOX,calendar_datenav%%\r\n</UL>\r\n</td></tr></table>\r\n</DIV>\r\n</td></tr></table>\r\n<p>\r\n\r\n\r\n<DIV class=\"cal_body\">\r\n\r\n<TABLE width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" style=\"border-right: 1px solid black; border-bottom: 1px solid black;\">\r\n<TR>\r\n <TH>Monday</TH>\r\n <TH>Tuesday</TH>\r\n <TH>Wednesday</TH>\r\n <TH>Thursday</TH>\r\n <TH>Friday</TH>\r\n <TH>Saturday</TH>\r\n <TH>Sunday</TH>\r\n</TR>\r\n<TR>\r\n %%d1%%\r\n %%d2%%\r\n %%d3%%\r\n %%d4%%\r\n %%d5%%\r\n %%d6%%\r\n %%d7%%\r\n</TR>\r\n\r\n</TABLE>\r\n</div>' WHERE bid = 'calendar_body_weekly';
UPDATE blocks SET block = '<LI><A href=\"%%link_url%%\"%%css_id%%>%%nav_link%%</A></LI>' WHERE bid = 'calendar_navigation_item';
UPDATE box SET content = 'my $content = \'\';\r\nmy $view = $S->cgi->param(\'view\') || $S->pref(\'calendar_view\');\r\nmy @date = $S->_get_date_array($S->cgi->param(\'date\'));\r\nmy $nav_items = $S->_calendar_date_navigation($view,@date);\r\n\r\nmy $prefix = \'&lt;&lt; \';\r\nmy $suffix = \'\';\r\nmy $stage = \'before\';\r\n\r\nforeach my $item (@$nav_items) {\r\n  warn \"Item is $item->{link_url}\\n\";\r\n  my $keys = {}; # keys for interpolation\r\n  my $string = $S->{UI}->{BLOCKS}->{calendar_navigation_item};\r\n  $keys->{link_url} = $item->{link_url};\r\n\r\n  #link text\r\n  my $text;\r\n  if ( $view eq \'monthly\' ) {\r\n    my $year = $date[0];\r\n	$year -= 1 if ($item->{date_array}->[1] > $date[1] && $stage eq \'before\');\r\n	$year += 1 if ($item->{date_array}->[1] < $date[1] && $stage eq \'after\');\r\n	$text = Date::Calc::Month_to_Text($item->{date_array}->[1]) . \" \" . $year;\r\n    warn \"Date is $text\\n\";\r\n  } else {\r\n    $text = Date::Calc::Date_to_Text(@{$item->{date_array}});\r\n  }\r\n  $keys->{nav_link} = \"$prefix$text$suffix\";\r\n\r\n  if ($item->{current}) {\r\n    $keys->{css_id} = $S->{UI}->{BLOCKS}->{calendar_navigation_hilight};\r\n    $keys->{nav_link} = $text;\r\n    $prefix = \'\';\r\n    $suffix = \' &gt;&gt;\';\r\n	$stage = \'after\'\r\n  }\r\n  $content .= $S->interpolate($string,$keys);\r\n}\r\n\r\n\r\nreturn $content;' WHERE boxid = 'calendar_datenav';
UPDATE box SET content = 'my ($sub_link, $content, $newevent, $modevents, $edit_cal);\r\nmy $cal_id = $S->cgi->param(\'calendar\');\r\n\r\nif ( $cal_id ) {\r\n  # viewing a particular calendar\r\n  if ($S->have_calendar_perm(\'edit\',$cal_id)) {\r\n    $edit_cal = qq{<A href=\"%%rootdir%%/editcalendar/settings/$cal_id\">Edit this calendar</A>};\r\n  }\r\n  if ($S->have_calendar_perm(\'submit\',$cal_id)) {\r\n    $newevent = qq{<A href=\"%%rootdir%%/submitevent/submit/$cal_id\">Submit new event</A>};\r\n  }\r\n  if ( $S->have_calendar_perm(\'moderate\',$cal_id) ) {\r\n    $modevents = qq{<A href=\"%%rootdir%%/editcalendar/moderate/$cal_id\">Moderate submitted events</A>};\r\n  }  \r\n} elsif ($S->have_perm(\'edit_own_calendar\')) {\r\n  # personal calendar view\r\n  $edit_cal = qq{<A href=\"%%rootdir%%/editcalendar\">Edit your calendar</A>} if $S->var(\'allow_user_calendars\');\r\n  my $cals = $S->_cal_submit_list();\r\n  my $use_submit = 0;\r\n  foreach ( @$cals ) {\r\n    if ( $S->pref(\"calendar_${_}_subscribe\") ) {\r\n      $use_submit = 1;\r\n      next;\r\n    }\r\n  }\r\n  if ( $use_submit ) {\r\n    $newevent = qq{<A href=\"%%rootdir%%/submitevent/submit\">Submit new event</A>};\r\n  }\r\n}\r\n\r\nmy @list;\r\nfor ($newevent, $modevents, $edit_cal, $sub_link) {\r\n	push @list, $_ if ($_);\r\n}\r\nmy $list = join(\' :: \', @list);\r\n$content = qq{\r\n<DIV class=\"cal_actions\">\r\n$list\r\n</DIV>};\r\n\r\nreturn $content;\r\n' WHERE boxid = 'calendar_actions';
