<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.70)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>4.11 Macros in Stories and Comments</TITLE>
<META NAME="description" CONTENT="4.11 Macros in Stories and Comments">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="sag.css">

<LINK REL="next" HREF="4_12_Spam_Crapflood.html">
<LINK REL="previous" HREF="4_10_Spell_checking_Stories.html">
<LINK REL="up" HREF="4_Scoop_Features.html">
<LINK REL="next" HREF="4_12_Spam_Crapflood.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><A href="http://scoop.kuro5hin.org/"><IMG src="small_logo.jpg"></A><UL><LI><A href="sag.html">SAG Home</A></LI>
<LI><A href="1_Introduction.html"><SPAN CLASS="arabic">1</SPAN> Introduction</A></LI>
<LI><A href="2_Installation.html"><SPAN CLASS="arabic">2</SPAN> Installation</A></LI>
<LI><A href="3_Setup_Administration.html"><SPAN CLASS="arabic">3</SPAN> Setup and Administration</A></LI>
<LI><A href="4_Scoop_Features.html"><SPAN CLASS="arabic">4</SPAN> Scoop Features and Customization</A></LI>
<UL>
<LI><A href="4_1_Story_Selection.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Story Selection</A></LI>
<LI><A href="4_2_User_Diaries.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> User Diaries</A></LI>
<LI><A href="4_3_Story_Archiving.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">3</SPAN> Story Archiving</A></LI>
<LI><A href="4_4_Story_Digest.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN> Story Digest Emails</A></LI>
<LI><A href="4_5_Story_Syndication.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">5</SPAN> Story Syndication (RDF)</A></LI>
<LI><A href="4_6_Story_hotlisting_bookma.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">6</SPAN> Story hotlisting/bookmarking</A></LI>
<LI><A href="4_7_Automatic_Related.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">7</SPAN> Automatic `Related Links' listing</A></LI>
<LI><A href="4_8_Comments_Comment.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">8</SPAN> Comments and Comment Views</A></LI>
<LI><A href="4_9_Polls.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">9</SPAN> Polls</A></LI>
<LI><A href="4_10_Spell_checking_Stories.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">10</SPAN> Spell-checking Stories and Comments</A></LI>
<LI><A href="4_11_Macros_in.html" id="current"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">11</SPAN> Macros in Stories and Comments</A></LI>
<LI><A href="4_12_Spam_Crapflood.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">12</SPAN> Spam and Crapflood Prevention</A></LI>
<LI><A href="4_13_Trusted_Users.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">13</SPAN> Trusted Users and Mojo</A></LI>
<LI><A href="4_14_Per_user_File.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">14</SPAN> Per-user File Uploads</A></LI>
<LI><A href="4_15_User_Subscriptions.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">15</SPAN> User Subscriptions</A></LI>
<LI><A href="4_16_User_submitted_Adverti.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">16</SPAN> User-submitted Advertisements</A></LI>
<LI><A href="4_17_Calendar.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">17</SPAN> Calendar</A></LI>
<LI><A href="4_18_Site_Layout.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">18</SPAN> Site Layout and Themes</A></LI>
<LI><A href="4_19_Flexible_Sections.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">19</SPAN> Flexible Sections and Categorization</A></LI>
<LI><A href="4_20_Searching_Relevance.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">20</SPAN> Searching by Relevance</A></LI>
<LI><A href="4_21_Page_Caching.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">21</SPAN> Page Caching</A></LI>
<LI><A href="4_22_Payment_Processing.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">22</SPAN> Payment Processing</A></LI>
<LI><A href="4_23_Admin_Action.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">23</SPAN> Admin Action Logging</A></LI>
<LI><A href="4_24_Access_Control.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">24</SPAN> Access Control While Upgrading</A></LI>
<LI><A href="4_25_Boxtool.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">25</SPAN> Boxtool</A></LI>
</UL>
<LI><A href="5_Extending_Scoop_s.html"><SPAN CLASS="arabic">5</SPAN> Extending Scoop's Abilities</A></LI>
<LI><A href="A_Admin_Tools.html">A. The Admin Tools Menu</A></LI>
<LI><A href="B_Scoop_Box.html">B. The Scoop Box Exchange</A></LI>
<LI><A href="C_Frequently_Asked.html">C. Frequently Asked Questions</A></LI>
<LI><A href="About_this_document.html">About this document ...</A></LI>
</UL>
</DIV>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION000411000000000000000"></A>
<A NAME="features-macros"></A>
<BR>
<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">11</SPAN> Macros in Stories and Comments
</H2>

<P>
Macros are at heart a bit like HTML tags. Instead of telling the browser what to do, though, macros tell Scoop what to do. This allows you to give users limited access to functions that could, if not limited, leave you with a security problem or stuff on your site that you don't want.

<P>
To configure the macro system, create the macro definitions you want to use, then set the variable <B>use_macros</B> to 1. Macro definitions are created in the Macros Admin Tool (<A HREF="A_20_Macros.html#admin-tools-macros">A.20</A>).

<P>
Macros can be either rendered when the story is saved or every time it's viewed using the variable <B>macro_render_on_save</B>. Which setting you want will depend on what your macros do. If all your macros do something completely static, then having them render on save can reduce the load on your server. If your macros are dynamic, or you want them to run with the environment and preferences of the user viewing the page instead of the story author, then macros should be rendered every time they're viewed.

<P>
When using the edit queue (<A HREF="4_1_Story_Selection.html#moderation-queues">4.1.1</A>) keep in mind that the author can edit the story after it's been saved, so if macros render on saving, when the author edits the story, he will be presented with the output of the macro rather than the macro command.

<P>
Macros can also be rendered `verbosely' by turning on the variable <B>macro_render_verbose</B>, that is, extra comments will be added around the macro and the original macro command will be preserved in an HTML comment when the rendered macro is displayed.

<P>
When the macro system is enabled, Scoop will scan stories and comments for existing macros and replace them with the macro definition you have created. Macros are indicated in stories and comments with double parentheses around the macro name. To use the included example macro, <B>macro_test</B>, you would put <B>((macro_test))</B> where you want the text of that macro to appear.

<P>
For example, if you have a box that you want users to be able to embed in a story or comment, you would do this via a macro. Normally, boxes and blocks are not substituted in stories for security reasons. If you created a macro with the box key (|BOX,boxid|) as the value, then that one box can be embedded in a story while denying access to the other boxes. Any box, block, or site control that can be interpolated into a regular block via vertical pipes is available to macros.

<P>
Macros can take arguments as well. If, for example, you want to allow users to embed images in their stories and comments but don't want them linking to any arbitrary picture out on the internet, you can create a macro with one argument that allows the user to specify the filename of an image in the directory you set. Arguments are used in the macro definition as <B>((1))</B> for the first argument, <B>((2))</B> for the second argument, and so on. With file uploads (<A HREF="4_14_Per_user_File.html#features-file-uploads">4.14</A>) and this macro, users could put images in their upload directory into their stories but no other images.

<P>
If you created a macro called <B>img</B> and gave it the definition <B>&lt;IMG src="|upload_link_user|((1))"&gt;</B> then a user could put <B>((img 2/filename.jpg))</B> in their story or comment, and that image would appear in their story. (The 2 in this example is the user's numeric UID.)

<P>
If macros don't seem to be working, try putting <B>((macro_test))</B> in a story or comment. If the system is active, that will be replaced by some red text telling you that the macro system is active. This macro is included by default as an example.

<P>

<HR>
<ADDRESS>
<I>janra <BR>
2005-02-27</I>
</ADDRESS>
</BODY>
</HTML>
