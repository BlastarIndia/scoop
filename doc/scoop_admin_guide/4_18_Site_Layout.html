<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.70)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>4.18 Site Layout and Themes</TITLE>
<META NAME="description" CONTENT="4.18 Site Layout and Themes">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="sag.css">

<LINK REL="next" HREF="4_19_Flexible_Sections.html">
<LINK REL="previous" HREF="4_17_Calendar.html">
<LINK REL="up" HREF="4_Scoop_Features.html">
<LINK REL="next" HREF="4_19_Flexible_Sections.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><A href="http://scoop.kuro5hin.org/"><IMG src="small_logo.jpg"></A><UL><LI><A href="sag.html">SAG Home</A></LI>
<LI><A href="1_Introduction.html"><SPAN CLASS="arabic">1</SPAN> Introduction</A></LI>
<LI><A href="2_Installation.html"><SPAN CLASS="arabic">2</SPAN> Installation</A></LI>
<LI><A href="3_Setup_Administration.html"><SPAN CLASS="arabic">3</SPAN> Setup and Administration</A></LI>
<LI><A href="4_Scoop_Features.html"><SPAN CLASS="arabic">4</SPAN> Scoop Features and Customization</A></LI>
<UL>
<LI><A href="4_1_Story_Selection.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Story Selection</A></LI>
<LI><A href="4_2_User_Diaries.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> User Diaries</A></LI>
<LI><A href="4_3_Story_Archiving.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">3</SPAN> Story Archiving</A></LI>
<LI><A href="4_4_Story_Digest.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN> Story Digest Emails</A></LI>
<LI><A href="4_5_Story_Syndication.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">5</SPAN> Story Syndication (RDF)</A></LI>
<LI><A href="4_6_Story_hotlisting_bookma.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">6</SPAN> Story hotlisting/bookmarking</A></LI>
<LI><A href="4_7_Automatic_Related.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">7</SPAN> Automatic `Related Links' listing</A></LI>
<LI><A href="4_8_Comments_Comment.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">8</SPAN> Comments and Comment Views</A></LI>
<LI><A href="4_9_Polls.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">9</SPAN> Polls</A></LI>
<LI><A href="4_10_Spell_checking_Stories.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">10</SPAN> Spell-checking Stories and Comments</A></LI>
<LI><A href="4_11_Macros_in.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">11</SPAN> Macros in Stories and Comments</A></LI>
<LI><A href="4_12_Spam_Crapflood.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">12</SPAN> Spam and Crapflood Prevention</A></LI>
<LI><A href="4_13_Trusted_Users.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">13</SPAN> Trusted Users and Mojo</A></LI>
<LI><A href="4_14_Per_user_File.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">14</SPAN> Per-user File Uploads</A></LI>
<LI><A href="4_15_User_Subscriptions.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">15</SPAN> User Subscriptions</A></LI>
<LI><A href="4_16_User_submitted_Adverti.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">16</SPAN> User-submitted Advertisements</A></LI>
<LI><A href="4_17_Calendar.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">17</SPAN> Calendar</A></LI>
<LI><A href="4_18_Site_Layout.html" id="current"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">18</SPAN> Site Layout and Themes</A></LI>
<LI><A href="4_19_Flexible_Sections.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">19</SPAN> Flexible Sections and Categorization</A></LI>
<LI><A href="4_20_Searching_Relevance.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">20</SPAN> Searching by Relevance</A></LI>
<LI><A href="4_21_Page_Caching.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">21</SPAN> Page Caching</A></LI>
<LI><A href="4_22_Payment_Processing.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">22</SPAN> Payment Processing</A></LI>
<LI><A href="4_23_Admin_Action.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">23</SPAN> Admin Action Logging</A></LI>
<LI><A href="4_24_Access_Control.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">24</SPAN> Access Control While Upgrading</A></LI>
<LI><A href="4_25_Boxtool.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">25</SPAN> Boxtool</A></LI>
</UL>
<LI><A href="5_Extending_Scoop_s.html"><SPAN CLASS="arabic">5</SPAN> Extending Scoop's Abilities</A></LI>
<LI><A href="A_Admin_Tools.html">A. The Admin Tools Menu</A></LI>
<LI><A href="B_Scoop_Box.html">B. The Scoop Box Exchange</A></LI>
<LI><A href="C_Frequently_Asked.html">C. Frequently Asked Questions</A></LI>
<LI><A href="About_this_document.html">About this document ...</A></LI>
</UL>
</DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A NAME="tex2html645"
  HREF="4_18_Site_Layout.html#SECTION000418100000000000000"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">1</SPAN> Block interactions</A>
<LI><A NAME="tex2html646"
  HREF="4_18_Site_Layout.html#SECTION000418200000000000000"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">2</SPAN> Themed Layout</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION000418000000000000000"></A>
<A NAME="features-custom"></A>
<BR>
<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">18</SPAN> Site Layout and Themes
</H2>

<P>
Most of <B>Scoop's layout is in the database</B>, accessible through the Blocks Admin Tool (<A HREF="A_7_Blocks.html#admin-tools-blocks">A.7</A>).  Any of the blocks can be altered in any way to change the entire layout of the site; some Scoop sites look nothing like Scoop's default install.  Any block can insert any other block simply by calling it by name using the <B>|block_name|</B> convention.  Please note that any vertical pipes (|) you want displayed literally must be escaped with a backslash (
<BR>|).

<P>
Blocks can also insert boxes, by using the <B>|BOX,box_name|</B> convention.  Scoop has to be told when the item to insert is a box, because <B>boxes and blocks are treated very differently</B>.  Blocks are simply inserted verbatim, replacing their reference; boxes are executed by the mod_perl interpreter, and their output is placed into the <B>content</B> and <B>title</B> special keys of a box template, which then replaces the box key.  Boxes are often used when part of a display is conditional, such as the user menu, which shows or hides menu items depending on the user's group permissions.

<P>
For most blocks, you can put anything you like in them and just see how it comes out; however, when altering the page templates, keep in mind that the admin pages--specifically, the Blocks Admin Tool--are created using the block <B>admin_template</B>, so if that's screwed up to the point where you can't use the page, you'll have to go into the database to fix it.  So take care, ok?

<P>
For boxes, if an error appears that is not noticed at compile time, it can cause your site to return a <B>500 Internal Server Error</B>, so it's good practice to test all boxes on a page template other than the admin_template, which is used to create the admin pages.

<P>

<H3><A NAME="SECTION000418100000000000000"></A>
<A NAME="blocks-interactions"></A>
<BR>
<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">1</SPAN> Block interactions
</H3>

<P>
Not every block is called directly using keys in other blocks, so tracing how the blocks interact can be difficult.  Some block calls appear to call nonexistant blocks, yet content appears in that place; those are special keys, and are specific to the block in which they appear.  <B>Most special keys are described in the block descriptions</B> in the database, but some important ones are described here.

<P>
The simplest case is when one block calls another; the text <B>|block_name|</B> in the calling block is replaced with the contents of the block <B>block_name</B>.  Because tracing blocks and their interactions can be so tricky, it is recommended practice to <B>make all blocks quite self-contained</B>; that is, don't open a tag in one block and close it in another, because that's just a nightmare to debug. 

<P>
The exceptions to the self-contained rule are things like the font tag blocks; those come in pairs, one that opens the tag and the other that closes it. Nothing but a font (or header, or span) indicator should be in those blocks, and the start and end tags must be balanced.

<P>
The first stage of block interaction is when Scoop determines which <B>page template</B> to use for a particular op (the first pseudo-directory), set using the Ops Admin Tool (<A HREF="A_16_Ops.html#admin-tools-ops">A.16</A>).  The front page, with no visible op, actually uses the op ``main''.  The page template is a full HTML page, and provides the core layout and positioning of content.  It generally includes a standard <B>header</B> and <B>footer</B> (both also blocks), the sidebar(s), and a special block called <B>CONTENT</B>, but no actual content of its own.

<P>
<B>CONTENT</B> is where the output of whichever function (set in the Ops Admin Tool) is called to build the page is placed.  The function grabs whichever blocks are needed to build the page, handles any special keys, then puts the whole thing in the place of <B>|CONTENT|</B>, after which the normal keys are interpolated normally.

<P>
For example, when you request the front page, Scoop builds the front page using the block <B>story_summary</B> once for each story on the front page.  The number of stories to be displayed is fetched from the variable <B>maxstories</B>, and Scoop limits the number of stories pulled from the database accordingly.  All the special keys in the <B>story_summary</B> block are filled in with the appropriate information from the database.

<P>
Similarly, when you request a specific story, Scoop uses the <B>story_summary</B>, <B>story_separator</B>, and <B>story_body</B> blocks; then it starts and ends the comments with <B>story_info</B>, which has information on the story and comments as well as the comment controls, then displays the comments themselves using the block <B>comment</B> or <B>moderation_comment</B>, depending on whether the comment is topical or editorial.  Again, most special keys are filled in with information from the database as described in the block descriptions.

<P>

<H3><A NAME="SECTION000418200000000000000"></A>
<A NAME="blocks-themes"></A>
<BR>
<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">18</SPAN>.<SPAN CLASS="arabic">2</SPAN> Themed Layout
</H3>

<P>
In addition to fully customizing the layout, you can have a different set of customizations appear based on several criteria using Scoop's theme engine.

<P>
Using themes, <B>any block at all can be replaced with a themed one</B>, and themes can be layered.  A theme can have as few as one block, or can replace all blocks.  Themes can be applied based on several criteria: which section is being viewed, both in story and section index views; what user group the visitor is in; what user agent the visitor's browser reports, the site's site_id variable, from the Apache configuration, and the visitor's user preference.  More criteria can be added fairly easily with a bit of perl-fu in the <B>theme_chooser</B> box.

<P>
<B>Themes are created through the normal block interface</B>.  To create a new theme, just add a new block with the name of the theme in the ``Theme'' text box; when you save the new block, the theme will be automatically created.  Similarly, to delete a theme, simply delete all the blocks in that theme; when the last block is deleted, the theme will be automatically removed.

<P>
Themes are layered by the simple method of replacing any blocks in the parent theme with the block of the same name in the child theme.  If more than one layer of theming is desired, debugging is simplified by having the layered themes replace non-overlapping sets of blocks from the default (base) theme.  

<P>
Non-overlapping themes also allow, for example, a structural theme, modifying the layout of the page, and a `colour' theme, only modifying colours, to be set independantly but apply seamlessly at the same time.  For example, a structural theme using tables and one using CSS can both call the same colour theme for a given section.  A theme may include blocks not present in the default theme; if that theme is then not applied, any references to blocks only present in that theme are treated as if they don't exist, that is, replaced silently with an empty string.

<P>
<B>To manage themes</B>, the variables in the ``Themes'' category of the Site Controls Admin Tool (<A HREF="A_6_Site_Controls.html#admin-tools-vars">A.6</A>) contain all the variables you will be using.  Themes in general are turned on or off by the variable <B>use_themes</B>.  Users may be permitted to select a theme to be layered with any others you have configured if the variable <B>allow_user_themes</B> is turned on.  This only allows them to select between ``none'' and the themes listed in the variable <B>user_themes</B>.  If the user has not selected a theme, the theme named in the variable <B>user_theme_default</B> is used.

<P>
To activate a theme selection criterion, its name must appear in the variable <B>order</B>, which also specifies the order in which themes are layered.  The default theme (named in the variable <B>default_theme</B>) is always applied first, to provide a complete foundation for the site.  If your themes have been carefully constructed to be non-overlapping, the order will not matter and the order variable simply names the criteria to be used in theme selection.  If they do overlap, however, the order in which theme criteria names appear is critical, as <B>themes applied earlier may be overwritten by themes applied later</B>, if there are any duplicate blocks between them.

<P>
Once you have decided on the order and criteria to use when applying themes, you must create variables to <B>specify which themes to apply where</B>.  (Make sure you file these new variables in the ``Themes'' category so they are easy to find later.)

<P>
The variables used to assign themes to criteria contain the name of a single theme as their value, and must be named according to a specific format, namely &lt;criterion&gt;_&lt;item&gt;.  

<P>
For example, if you have a section with the display name ``Site News'' and the internal name ``site_news'', and you want a theme to apply to the section index page and all stories filed in that section, you would create a text variable called section_site_news and give it the name of the theme you want to use as a value.  You must create one such variable for each section you want to apply a theme to.  The front page is not assigned a section, so the default theme should contain its specific blocks.

<P>
The criterion portion of the variable name must match the criterion name listed in the order variable, and the item portion of the variable name must match the internal name Scoop uses for its sections, user groups, and site ID (set in the httpd.conf file).  For the user agent theme, the item must match one of the strings the box <B>detect_agent</B> returns.  

<P>
User agent detection is currently not functional and always returns an empty string. User agent detection is generally not considered a good idea, as you're not likely to think of every possible user agent that might reach your site. If there is one particular browser that chokes on a particular part of your site, though, you may want to detect that one browser and give it a theme with the troublesome part done in a way it can understand.

<P>

<HR>
<ADDRESS>
<I>janra <BR>
2005-02-27</I>
</ADDRESS>
</BODY>
</HTML>
