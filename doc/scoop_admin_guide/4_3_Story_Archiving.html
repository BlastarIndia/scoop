<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.70)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>4.3 Story Archiving</TITLE>
<META NAME="description" CONTENT="4.3 Story Archiving">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="sag.css">

<LINK REL="next" HREF="4_4_Story_Digest.html">
<LINK REL="previous" HREF="4_2_User_Diaries.html">
<LINK REL="up" HREF="4_Scoop_Features.html">
<LINK REL="next" HREF="4_4_Story_Digest.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><A href="http://scoop.kuro5hin.org/"><IMG src="small_logo.jpg"></A><UL><LI><A href="sag.html">SAG Home</A></LI>
<LI><A href="1_Introduction.html"><SPAN CLASS="arabic">1</SPAN> Introduction</A></LI>
<LI><A href="2_Installation.html"><SPAN CLASS="arabic">2</SPAN> Installation</A></LI>
<LI><A href="3_Setup_Administration.html"><SPAN CLASS="arabic">3</SPAN> Setup and Administration</A></LI>
<LI><A href="4_Scoop_Features.html"><SPAN CLASS="arabic">4</SPAN> Scoop Features and Customization</A></LI>
<UL>
<LI><A href="4_1_Story_Selection.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">1</SPAN> Story Selection</A></LI>
<LI><A href="4_2_User_Diaries.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">2</SPAN> User Diaries</A></LI>
<LI><A href="4_3_Story_Archiving.html" id="current"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">3</SPAN> Story Archiving</A></LI>
<LI><A href="4_4_Story_Digest.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">4</SPAN> Story Digest Emails</A></LI>
<LI><A href="4_5_Story_Syndication.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">5</SPAN> Story Syndication (RDF)</A></LI>
<LI><A href="4_6_Story_hotlisting_bookma.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">6</SPAN> Story hotlisting/bookmarking</A></LI>
<LI><A href="4_7_Automatic_Related.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">7</SPAN> Automatic `Related Links' listing</A></LI>
<LI><A href="4_8_Comments_Comment.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">8</SPAN> Comments and Comment Views</A></LI>
<LI><A href="4_9_Polls.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">9</SPAN> Polls</A></LI>
<LI><A href="4_10_Spell_checking_Stories.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">10</SPAN> Spell-checking Stories and Comments</A></LI>
<LI><A href="4_11_Macros_in.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">11</SPAN> Macros in Stories and Comments</A></LI>
<LI><A href="4_12_Spam_Crapflood.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">12</SPAN> Spam and Crapflood Prevention</A></LI>
<LI><A href="4_13_Trusted_Users.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">13</SPAN> Trusted Users and Mojo</A></LI>
<LI><A href="4_14_Per_user_File.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">14</SPAN> Per-user File Uploads</A></LI>
<LI><A href="4_15_User_Subscriptions.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">15</SPAN> User Subscriptions</A></LI>
<LI><A href="4_16_User_submitted_Adverti.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">16</SPAN> User-submitted Advertisements</A></LI>
<LI><A href="4_17_Calendar.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">17</SPAN> Calendar</A></LI>
<LI><A href="4_18_Site_Layout.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">18</SPAN> Site Layout and Themes</A></LI>
<LI><A href="4_19_Flexible_Sections.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">19</SPAN> Flexible Sections and Categorization</A></LI>
<LI><A href="4_20_Searching_Relevance.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">20</SPAN> Searching by Relevance</A></LI>
<LI><A href="4_21_Page_Caching.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">21</SPAN> Page Caching</A></LI>
<LI><A href="4_22_Payment_Processing.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">22</SPAN> Payment Processing</A></LI>
<LI><A href="4_23_Admin_Action.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">23</SPAN> Admin Action Logging</A></LI>
<LI><A href="4_24_Access_Control.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">24</SPAN> Access Control While Upgrading</A></LI>
<LI><A href="4_25_Boxtool.html"><SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">25</SPAN> Boxtool</A></LI>
</UL>
<LI><A href="5_Extending_Scoop_s.html"><SPAN CLASS="arabic">5</SPAN> Extending Scoop's Abilities</A></LI>
<LI><A href="A_Admin_Tools.html">A. The Admin Tools Menu</A></LI>
<LI><A href="B_Scoop_Box.html">B. The Scoop Box Exchange</A></LI>
<LI><A href="C_Frequently_Asked.html">C. Frequently Asked Questions</A></LI>
<LI><A href="About_this_document.html">About this document ...</A></LI>
</UL>
</DIV>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00043000000000000000"></A>
<A NAME="features-archive"></A>
<BR>
<SPAN CLASS="arabic">4</SPAN>.<SPAN CLASS="arabic">3</SPAN> Story Archiving
</H2>

<P>
For large, busy sites, the database can become too large for the server to handle; specifically, the indexes become too large to keep in memory, and the whole thing <B>slows down drastically</B>.  Story and comment archiving addresses that by moving older stories and comments to a secondary database.

<P>
The primary database is used for new and still-active stories and their comments; the archive database is used for older stories, and <B>does not allow new comments</B>, ratings, or poll votes.  Archived stories are available at the same URL as they were before being archived, to prevent links bringing people to your site from breaking.  To search the archive for comments and stories, the user must check the ``Search Archive'' box in the search form as the regular and archive databases are searched separately.

<P>
To <B>set up the archive database</B>, you must first create the database and set the access rules for it as described in section&nbsp;<A HREF="2_5_Installing_Hand.html#manual-db">2.5.1</A>.  This is the same procedure as for the regular database, but you must substitute the name of the archive database and its sql file in the command.  The sql file for the archive database is in your scoop/struct/archive directory.  You may use the same database username and password for the regular and archive databases.

<P>
For Scoop to <B>access the archive database</B> properly, you have to tell Apache about it in the httpd.conf file, or wherever your main Scoop config directives are:

<P>
<PRE>
# Archive config:
# Set these vars if you use an archive database

# The name of the archive database
PerlSetVar db_name_archive __DBNAMEARCHIVE__

# The host where mySQL is running
PerlSetVar db_host_archive __DBHOSTARCHIVE__

# The user to connect as
PerlSetVar db_user_archive __DBUSERARCHIVE__

# The user's database password
PerlSetVar db_pass_archive __DBPASSARCHIVE__
</PRE>

<P>
Substitute the correct values for the name, host, user, and password, then stop and start Apache (never restart).  A good place to paste these commands in your config file is right after the commands for your regular database; that way they're all together.

<P>
Archiving is controlled through the variables in the Site Controls Admin Tool (<A HREF="A_6_Site_Controls.html#admin-tools-vars">A.6</A>).

<P>
Stories and their comments are archived together; polls, even those attached to stories, are archived separately.

<P>
Stories are archived based on their age and optionally their activity.  The variable <B>story_archive_age</B> sets the age of a story in days before it will be considered for archiving.  Any story posted (not submitted) more days ago than this value will be archived or considered for archiving.  To disable story archiving, set <B>story_archive_age</B> to 0.

<P>
If you wish to <B>protect old but active stories</B> from archiving, the variable <B>comment_archive_age</B> is what you want.  Stories considered for archiving are tested for new comments; if they have any comments newer than the age in this variable, they are not archived.  If the newest comment is older than the age in this variable, then the story is archived.  To disable this check and archive stories purely on their age, set <B>comment_archive_age</B> to 0.

<P>
In addition to archiving stories and their comments, you have the option of <B>archiving a story's voting record</B> instead of just its displaystatus (Front Page or Section).  You also have the option of <B>archiving a comment's rating history</B>, instead of just its score and the number of ratings.  Both of these are informational only, and archiving and display will work equally well with or without them.  They are set using the variables <B>archive_moderations</B> and <B>archive_ratings</B>, respectively.

<P>
Polls are archived based purely on their age; there is no option to protect active polls.  The variable <B>poll_archive_age</B> sets the age of a poll in days before it will be archived.  To disable poll archiving, set <B>poll_archive_age</B> to 0.

<P>
Once the archive database and archiving configuration are set, the actual <B>process of archiving</B> is started using the Cron Admin Tool (<A HREF="A_14_Cron.html#admin-tools-cron">A.14</A>).  The cron item <B>archive_stories</B> runs the code that checks the age of stories and comments, then archives those that match the criteria set in the Site Controls.  The cron item <B>poll_archive</B> runs the code that checks the age of polls, then archives those that match the criteria set it the Site Controls.

<P>

<HR>
<ADDRESS>
<I>janra <BR>
2005-02-27</I>
</ADDRESS>
</BODY>
</HTML>
